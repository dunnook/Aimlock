if getgenv().Aimlock_Loaded == true then
	game:GetService("StarterGui"):SetCore("SendNotification", {
		Title = "Aimlock already loaded!",
		Text = "Aimlock already loaded!",
		Duration = 5
	})
	return
end
getgenv().Aimlock_Loaded = true
local enabled = false
local uis = game:GetService("UserInputService")
local plr = game:GetService("Players")
local lp = plr.LocalPlayer
local mouse = lp:GetMouse()
local enums = Enum.UserInputType:GetEnumItems()
for i, v in next, Enum.KeyCode:GetEnumItems() do
	table.insert(enums, v)
end
for i, v in next, enums do
	local split = string.split(tostring(v), ".")
	local enumName = split[#split]
	enums[enumName:lower()] = {
		split[2],
		enumName
	}
end
if enums[Aim_Key] then
	Aim_Key = Enum[enums[Aim_Key][1]][enums[Aim_Key][2]]
else
	Aim_Key = Enum.UserInputType.MouseButton2
end
function getChar(plr)
    if plr == nil then return end
    return plr.Character or plr.CharacterAdded:Wait()
end
function getClosestMouse()
    local range, player, part = math.huge
    for i, v in next, plr:GetPlayers() do
        if v ~= lp and getChar(v):FindFirstChildOfClass("Humanoid") and getChar(v):FindFirstChild("Head") then
            local rayOrigin = workspace.CurrentCamera.CFrame.Position
            local rayDirection = getChar(v).PrimaryPart.Position - rayOrigin
            local params = RaycastParams.new()
            params.FilterDescendantsInstances = {getChar(lp), getChar(v)}
            params.FilterType = Enum.RaycastFilterType.Blacklist
            local raycastResult = workspace:Raycast(rayOrigin, rayDirection, params)
            local partpos, isSuccess = workspace.CurrentCamera:WorldToViewportPoint(getChar(v).Head.Position)
			local distToMouse = (Vector2.new(partpos.X, partpos.Y) - Vector2.new(mouse.x, mouse.y)).Magnitude
            if raycastResult == nil and isSuccess == true and distToMouse < range and distToMouse < settings.Circle_Radius then
                range = (Vector2.new(partpos.x, partpos.y) - Vector2.new(mouse.x, mouse.y)).Magnitude
                player = v
            end
        end
    end
    return player, range
end
local circle = Drawing.new("Circle")
circle.Radius = 200
circle.Transparency = 1
circle.Thickness = 1
circle.Visible = true
circle.Filled = false
local i = 0
task.spawn(function()
	game:GetService("RunService").RenderStepped:Connect(function()
		if i >= 1 then 
			i = 0 
		end
		i += 0.0001 * settings.Circle_Color_Speed
		circle.Visible = settings.Circle_Visible
		circle.Radius = settings.Circle_Radius
		circle.Position = Vector2.new(mouse.X * settings.Windows_Scale / 100, mouse.Y * settings.Windows_Scale / 100 + (36 * settings.Windows_Scale/100))
		task.wait()
		circle.Color = Color3.fromHSV(i, 1, 1)
	end)
end)
uis.InputBegan:Connect(function(key)
	local Aim_Key = string.lower(settings.Aim_Key)
	if enums[Aim_Key] then
		Aim_Key = Enum[enums[Aim_Key][1]][enums[Aim_Key][2]]
	else
		Aim_Key = Enum.UserInputType.MouseButton2
	end
    if key.UserInputType == Aim_Key or key.KeyCode == Aim_Key then
        enabled = not enabled
		local plr, _ = getClosestMouse()
        while true do
            if enabled == false then return end
			if settings.Aim_Lock == false then
				plr, _ = getClosestMouse()
			end
			local vPrediction;
			if settings.Aim_Predict == true then
				--Velocity prediction
				local plrVelocity = getChar(plr):FindFirstChild(settings.Aim_Part).Velocity
				vPrediction = plrVelocity * game.Players.LocalPlayer:GetNetworkPing() * 10
			end
			local prediction = vPrediction
			task.wait()
            if plr ~= nil and getChar(plr):FindFirstChild(settings.Aim_Part) then
                workspace.CurrentCamera.CFrame = CFrame.new(workspace.CurrentCamera.CFrame.Position, getChar(plr):FindFirstChild(settings.Aim_Part).CFrame.Position + prediction)
            end
        end
    end
end)
uis.InputEnded:Connect(function(key)
	local Aim_Key = string.lower(settings.Aim_Key)
	if enums[Aim_Key] then
		Aim_Key = Enum[enums[Aim_Key][1]][enums[Aim_Key][2]]
	else
		Aim_Key = Enum.UserInputType.MouseButton2
	end
    if key.UserInputType == Aim_Key or key.KeyCode == Aim_Key then
		if settings.Aim_Hold == true then
        	enabled = false
		end
    end
end)
game:GetService("StarterGui"):SetCore("SendNotification", {
	Title = "Aimlock Loaded!"; -- the title (ofc)
	Text = "Right click to lock aim"; -- what the text says (ofc)
	Duration = 5; -- how long the notification should in secounds
})
